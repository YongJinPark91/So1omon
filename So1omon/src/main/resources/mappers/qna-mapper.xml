<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="qnaMapper">

  	<resultMap type="Question" id="questionResult">
  		<result column="Q_NO" property="qno" />
  		<result column="Q_WRITER" property="qwriter" />
  		<result column="REF_NO" property="refNO" />
  		<result column="Q_TITLE" property="qtitle" />
  		<result column="Q_CONTENT" property="qcontent" />
  		<result column="Q_CATEGORY" property="qcategory" />
  		<result column="Q_DATE" property="qdate" />
  		<result column="Q_STATUS" property="qstatus" />
  	</resultMap>
  	
  	<resultMap type="Answer" id="answerResult">
  		<result column="A_NO" property="ano" />
  		<result column="Q_NO" property="qno" />
  		<result column="A_CONTENT" property="acontent" />
  		<result column="A_DATE" property="adate" />
  		<result column="A_STATUS" property="astatus" />
  	</resultMap>
  	
  	<resultMap type="Attachment" id="attachmentResult">
  		<result column="FILE_NO" property="fileNo" />
  		<result column="REF_NO" property="refNo" />
  		<result column="ORIGIN_NAME" property="originName" />
  		<result column="CHANGE_NAME" property="changeName" />
  		<result column="FILE_PATH" property="filePath" />
  		<result column="UPLOAD_DATE" property="uploadDate" />
  		<result column="STATUS" property="status" />
  	</resultMap>

  	
  	<select id="selectQnaListCount" resultType="_int">
		select
		       count(*)
		  from question
  	</select>
  	
  	<select id="selectQnaList" resultMap="questionResult">
	  	select
	       TO_NUMBER(SUBSTR(q_no, 2)) AS q_no  
	     , q_title
	     , user_id as q_writer
	     , q_status
	     , to_char(q_date, 'YYYY-MM-DD') as "q_date"
	  from question
	  join member on(q_writer = user_no)
	 order
	    by q_no desc
  	</select>
  	
  	<select id="selectSearchCount" resultType="_int">
		select
		       count(*)
		  from question q
		  join member on (q_writer = user_no)
		 
		 <if test="condition == 'title'">
		   and q_title  
		 </if>
		 <if test="condition == 'content'">
		   and q_content
		 </if>
		   like '%' || #{keyword} || '%'
  	</select>
  	
  	
  	<select id="selectSearchList" resultMap="questionResult">
  		select
		       TO_NUMBER(SUBSTR(q_no, 2)) AS q_no 
		     , q_title
		     , user_id as q_writer 
		     , q_date
             , q_status
		  from question q
		  join member on (q_writer = user_no)
		 
		 <if test="condition == 'title'">
		   and q_title  
		 </if>
		 <if test="condition == 'content'">
		   and q_content
		 </if>
		   like '%' || #{keyword} || '%'
  	</select>
  	
  	<insert id="insertQna">
  		insert
		  into question
		  (
		    q_no
		  , q_writer
		  , q_title
		  , ref_no
		  , q_content
		  , q_category
		  , q_date
		  , q_status
		  )
		  values
		  (
		    'Q' || SEQ_QNO.NEXTVAL
		  , (select user_no
               from member
              where user_id = #{qwriter})  
		  , #{qtitle}
		  , 'Q' || SEQ_QNO.currval 
		  , #{qcontent}
		  , #{qcategory}
		  , default
		  , default
		  )

  	</insert>
  	
  	
  	<insert id="insertFile">
  		insert
		  into attachment
		  (
		    file_no
		  , ref_no
		  , origin_name
		  , change_name
		  , file_path
		  , upload_date
		  , status
		  )
		  values
		  (
		    SEQ_FNO.NEXTVAL
          , 'Q' || seq_qno.currval
          , #{originName}
          , #{changeName}
          , #{filePath}
          , default
          , default

		  )
  	</insert>
  	
  	<select id="selectQuestion" resultMap="questionResult">
  		select 
		       q_no
		     , user_id as q_writer
		     , ref_no
		     , q_title
		     , q_content
		     , q_category
		     , to_char(q_date, 'YYYY-MM-DD') as "q_date"
		     , q_status
		  from question
		  join member on (q_writer = user_no)
		 where q_no = 'Q' || #{qno}
  	</select>
  	
	<select id="selectQuestionFile" resultMap="attachmentResult">
		select
			   file_no
			 , ref_no
			 , origin_name
			 , change_Name
			 , file_path

		  from attachment
		 where ref_no = 'Q' || #{qno}  
	</select>


</mapper>